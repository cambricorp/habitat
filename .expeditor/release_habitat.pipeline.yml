expeditor:
  secrets:
    ACCEPTANCE_HAB_AUTH_TOKEN:
      path: account/static/habitat/chef-ci
      field: scotthain-sig-key
  defaults:
    buildkite:
      timeout_in_minutes: 30
      env:
        HAB_ORIGIN: "core"
        ACCEPTANCE_HAB_BLDR_URL: "https://bldr.acceptance.habitat.sh"
        # HAB_LICENSE: "accept-no-persist"
        # HAB_STUDIO_SECRET_HAB_LICENSE: "accept-no-persist"

steps:
#######################################################################
# Release!
#######################################################################

  # TODO If you add quotes around the target currently breaks a bash case statement :/
  - label: "[build hab]"
    command:
      - .expeditor/scripts/build_component.sh hab
    expeditor:
      executor:
        docker:
          privileged: true
          environment:
            - HAB_ORIGIN
            - BUILD_PKG_TARGET=x86_64-linux
            - ACCEPTANCE_HAB_AUTH_TOKEN
            - ACCEPTANCE_HAB_BLDR_URL

  - label: "[build hab-plan-build]"
    command:
      - .expeditor/scripts/build_component.sh plan-build
    expeditor:
      executor:
        docker:
          privileged: true
          environment:
            - HAB_ORIGIN
            - BUILD_PKG_TARGET=x86_64-linux
            - ACCEPTANCE_HAB_AUTH_TOKEN
            - ACCEPTANCE_HAB_BLDR_URL

  - wait

  - label: "[build hab-backline]"
    command:
      - .expeditor/scripts/build_component.sh backline
    expeditor:
      executor:
        docker:
          privileged: true
          environment:
            - HAB_ORIGIN
            - BUILD_PKG_TARGET=x86_64-linux
            - ACCEPTANCE_HAB_AUTH_TOKEN
            - ACCEPTANCE_HAB_BLDR_URL
